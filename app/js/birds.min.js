var camera,scene,renderer,birds,bird,boid,boids,stats,SCREEN_WIDTH=window.innerWidth,SCREEN_HEIGHT=window.innerHeight,SCREEN_WIDTH_HALF=SCREEN_WIDTH/2,SCREEN_HEIGHT_HALF=SCREEN_HEIGHT/2;function init(){(camera=new THREE.PerspectiveCamera(75,SCREEN_WIDTH/SCREEN_HEIGHT,1,1e4)).position.z=450,(scene=new THREE.Scene).background=new THREE.Color(16777215),birds=[],boids=[];for(var e=0;e<200;e++)(boid=boids[e]=new Boid).position.x=400*Math.random()-200,boid.position.y=400*Math.random()-200,boid.position.z=400*Math.random()-200,boid.velocity.x=2*Math.random()-1,boid.velocity.y=2*Math.random()-1,boid.velocity.z=2*Math.random()-1,boid.setAvoidWalls(!0),boid.setWorldSize(500,500,400),(bird=birds[e]=new THREE.Mesh(new Bird,new THREE.MeshBasicMaterial({color:16777215*Math.random(),side:THREE.DoubleSide}))).phase=Math.floor(62.83*Math.random()),scene.add(bird);(renderer=new THREE.CanvasRenderer).setPixelRatio(window.devicePixelRatio),renderer.setSize(SCREEN_WIDTH,SCREEN_HEIGHT),document.addEventListener("mousemove",onDocumentMouseMove,!1),document.querySelector(".birds").appendChild(renderer.domElement),window.addEventListener("resize",onWindowResize,!1)}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function onDocumentMouseMove(e){for(var i=new THREE.Vector3(e.clientX-SCREEN_WIDTH_HALF,-e.clientY+SCREEN_HEIGHT_HALF,0),o=0,n=boids.length;o<n;o++)boid=boids[o],i.z=boid.position.z,boid.repulse(i)}function animate(){requestAnimationFrame(animate),render()}function render(){for(var e=0,i=birds.length;e<i;e++){(boid=boids[e]).run(boids),(bird=birds[e]).position.copy(boids[e].position);var o=bird.material.color;o.r=o.g=o.b=(500-bird.position.z)/1e3,bird.rotation.y=Math.atan2(-boid.velocity.z,boid.velocity.x),bird.rotation.z=Math.asin(boid.velocity.y/boid.velocity.length()),bird.phase=(bird.phase+(Math.max(0,bird.rotation.z)+.1))%62.83,bird.geometry.vertices[5].y=bird.geometry.vertices[4].y=5*Math.sin(bird.phase)}renderer.render(scene,camera)}init(),animate();